{% extends "layout.html" %}
{% block title %}Edit Job — GetAJob{% endblock %}

{% block content %}
<h2 style="color:var(--primary); margin-bottom:12px;">Edit job</h2>

<div class="form-card">
  <form method="post" action="{{ url_for('edit_job', job_id=job.id) }}" id="editJobForm" autocomplete="off">
    <label>Title</label>
    <input name="title" class="input" type="text" required value="{{ job.title or '' }}">

    <label style="margin-top:12px;">Description</label>
    <textarea name="description" class="input" required>{{ job.description or '' }}</textarea>

    <label style="margin-top:12px;">Location (address)</label>
    <div style="position:relative;">
      <input id="locationText" name="location_text" class="input" type="text" value="{{ job.location_text or '' }}" placeholder="Street, City, State or City, Country" aria-autocomplete="list" aria-haspopup="true" aria-expanded="false" />
      <div id="addrSuggestions" role="listbox" aria-label="Address suggestions" style="display:none; position:absolute; left:0; right:0; top:calc(100% + 6px); z-index:60;"></div>
    </div>

    <div style="display:flex; gap:12px; margin-top:8px; align-items:center;">
      <button type="button" id="findAddrBtn" class="btn btn-outline">Find address</button>
      <div id="geocodeStatus" class="small text-muted" aria-live="polite" style="min-width:220px;"></div>
    </div>

    <input type="hidden" id="latHiddenForServer" name="lat" value="{{ job.lat or '' }}">
    <input type="hidden" id="lngHiddenForServer" name="lng" value="{{ job.lng or '' }}">

    <div id="previewWrapper" style="margin-top:12px; display:none;">
      <div style="font-size:0.95rem; color:var(--muted); margin-bottom:6px;">Preview location</div>
      <img id="previewMap" src="" alt="Location preview" style="width:100%; max-width:420px; border-radius:8px; border:1px solid rgba(0,0,0,0.06);">
    </div>

    <div style="display:flex; gap:12px; margin-top:12px;">
      <div style="flex:1;">
        <label>Lat (optional)</label>
        <input id="latManual" name="lat_manual" class="input" type="text" placeholder="Optional — auto filled" value="{{ job.lat or '' }}">
      </div>
      <div style="flex:1;">
        <label>Lng (optional)</label>
        <input id="lngManual" name="lng_manual" class="input" type="text" placeholder="Optional — auto filled" value="{{ job.lng or '' }}">
      </div>
    </div>

    <label style="margin-top:12px;">Salary</label>
    <input name="salary" class="input" type="text" value="{{ job.salary or '' }}">

    <label style="margin-top:12px;">Tags (comma separated)</label>
    <input name="tags" class="input" type="text" value="{{ job.tags or '' }}">

    <div class="form-actions" style="margin-top:14px;">
      <button class="btn btn-primary" type="submit">Save changes</button>
      <a class="btn btn-outline" href="{{ url_for('job_detail', job_id=job.id) }}">Cancel</a>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
<!-- reuse the same script/style as post_job (bias via GPS -> /_client_location -> NYC fallback) -->
<style>
#addrSuggestions { background:#fff; border:1px solid rgba(0,0,0,0.08); border-radius:8px; box-shadow:0 8px 20px rgba(0,0,0,0.06); max-height:240px; overflow:auto; padding:6px; }
.addr-suggestion { padding:8px 10px; cursor:pointer; border-radius:6px; font-size:0.95rem; color:var(--text); }
.addr-suggestion:hover, .addr-suggestion[aria-selected="true"] { background: rgba(216,111,42,0.06); }
.addr-suggestion small { display:block; color:var(--muted); font-size:0.82rem; margin-top:4px; }
</style>

<script>
/* same JS as in post_job template (omitted here for brevity) — ensure you copy the same script block used in post_job */
</script>
{% endblock %}