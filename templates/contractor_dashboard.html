{% extends "layout.html" %}
{% block title %}My Applications — GetAJob{% endblock %}

{% block content %}
  <h2 style="margin-top:0; color:var(--primary);">My Applications</h2>
  <p class="meta" style="color:#666;margin-top:6px;">
    Here are the jobs you applied for.
  </p>

  <hr>

  {% if applications %}
    <ul style="list-style:none;padding:0;margin:0;">
      {% for item in applications %}
        {% set app = item.application %}
        {% set job = item.job %}
        {% set emp = item.employer %}
        <li style="padding:12px 0;border-bottom:1px solid #eee;">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;">
            <div style="flex:1; min-width:0;">
              {% if job %}
                <div style="font-weight:600;font-size:1.05rem;">
                  <a href="{{ url_for('job_detail', job_id=job.id) }}">{{ job.title }}</a>
                </div>
                <div class="meta" style="color:#666;margin-top:6px;">
                  {% if emp %}
                    Posted by:
                    <a href="{{ url_for('profile', user_id=emp.id) }}">
                      {{ emp.username or emp.first_name or emp.email }}
                    </a>
                  {% else %}
                    Posted by: (deleted employer)
                  {% endif %}
                  • Applied: {{ app.created_at|date_only }}
                  {% if job.location_text %}• {{ job.location_text|short_addr }}{% endif %}
                </div>
                <div style="margin-top:8px;color:#333;">
                  {{ job.description[:250] }}{% if job.description and job.description|length > 250 %}...{% endif %}
                </div>

                {% if app.cover_letter_path or app.resume_path %}
                  <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
                    {% if app.cover_letter_path %}
                      {% set cl_filename = app.cover_letter_path.split('/')[-1].split('\\')[-1] %}
                      <a class="btn btn-outline" href="{{ url_for('uploaded_file', filename=cl_filename) }}" target="_blank" rel="noopener">View cover letter</a>
                    {% endif %}
                    {% if app.resume_path %}
                      {% set res_filename = app.resume_path.split('/')[-1].split('\\')[-1] %}
                      <a class="btn btn-outline" href="{{ url_for('uploaded_file', filename=res_filename) }}" target="_blank" rel="noopener">View resume</a>
                    {% endif %}
                  </div>
                {% endif %}
              {% else %}
                <div style="font-weight:600;">(Job removed)</div>
                <div class="meta" style="color:#666;margin-top:6px;">
                  Applied: {{ app.created_at|date_only }}
                </div>
              {% endif %}
            </div>

            <div style="text-align:right;min-width:140px;">
              {% if job %}
                <a class="btn btn-outline" href="{{ url_for('job_detail', job_id=job.id) }}">View job</a>
              {% endif %}
              <div style="margin-top:8px;color:#666;font-size:0.9rem;">Application ID: {{ app.id }}</div>
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p style="color:var(--muted);">No applications found. Browse <a href="{{ url_for('jobs_list') }}">jobs</a> and apply to ones you like.</p>
  {% endif %}
</div>
{% endblock %}